<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://DETO.com/4_examples/4.1.3_Constructing_a_DETO_script/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>4.1.3 Constructing a DETO script - DETO_3D</title>
  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "4.1.3 Constructing a DETO script";
    var mkdocs_page_input_path = "4_examples/4.1.3_Constructing_a_DETO_script.md";
    var mkdocs_page_url = "/4_examples/4.1.3_Constructing_a_DETO_script/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> DETO_3D</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">1. Instalation</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../1_instaling/1.1_cloning/">1.1. Cloning</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../1_instaling/1.2_submodules/">1.2. Submodules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../1_instaling/1.3_building/">1.3. Building</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">2. Input</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../2_running/2.1_input/">2.1. Input</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../2_running/2.2_chimap/">2.2. Chi Map</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../2_running/2.3_potfile/">2.3. Potfile</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">3. commands</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.1_subcomm/">3.1. subcomm</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.2_lammps/">3.2. lammps</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.3_simulation/">3.3. simulation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.4_add_attribute/">3.4. add_attribute</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.5_opt_map_chi/">3.5. opt_map_chi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.6_read_potentials/">3.6. read_potentials</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.7_opt_type/">3.7. opt_type</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.8_objective_function/">3.8. objective_function</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.9_add_objective/">3.9. add_objective</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.10_add_constraint/">3.10. add_constraint</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.11_dump/">3.11. dump</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.12_write_plog/">3.12. write_plog</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../3_commands/3.13_write_lmp_log/">3.13. write_lmp_log</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">4. examples</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../4.1_L_Shape/">4.1. L Shaped beam</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DETO_3D</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>4.1.3 Constructing a DETO script</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/Connor-OS/DETO/edit/master/docs/4_examples/4.1.3_Constructing_a_DETO_script.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>The DETO input script sets up and runs an optimisation in DETO. combines the LAMMPS model, chi map and potential file from the previous steps together and defines the forces and dynamic or quasi-static conditions to optimise against in the form of a simulation.</p>
<p>The commands used in this script are unique to DETO and so will not run natively in LAMMPS.</p>
<p>To break down the use of the commands in the script below:</p>
<ul>
<li>First <a href="3_commands/3.7_opt_type"><code>opt_type</code></a> is used to specify a gradient descent optimisation method with a move limit of 0.1 and a total chi fraction of 0.5 meaning that between each step agiven particels chi value cannot fluctuate more than 0.1 and the optimisation is constrained to keep the average chi across the system below 0.5.</li>
<li>A single objective function is specified with <a href="3_commands/3.8_objective_function"><code>objective_function</code></a> this will be linked to a LAMMPS variable with a later command</li>
<li>One sub communicator is specified meaning the program will run only a single execution thread.</li>
<li>The <a href="3_commands/3.2_lammps"><code>lammps</code></a> commands specified in in.Lshape_lmp are read into the system and executed on a LAMMPS instance, to generate the initial configuration of the system. The commands could instead have been written into this script each prepended by the keyword <a href="3_commands/3.2_lammps"><code>lammps</code></a>. However it can be useful to store them in a separate file as is done here.</li>
<li>The <a href="3_commands/3.11_dump"><code>dump</code></a> command initialises a optimisation wide dump file which takes the same inputs as the <a href="https://docs.lammps.org/dump.html">lammps dump</a>command except dumps an output ever N optimisation steps instead of simulated time steps here N is specified as 1 to capture a dump after each optimisation step.</li>
<li><a href="3_commands/3.5_opt_map_chi"><code>opt_map_chi</code></a> reads in the previously defined chi map</li>
<li><a href="3_commands/3.6_read_potentials"><code>read_potentials</code></a> reads in the previously defined potentials file</li>
<li>The <a href="3_commands/3.3_simulation"><code>simulation</code></a> command instantiates a simulation called <code>Sim1</code> to be run as part of this optimisation.</li>
<li>The <a href="3_commands/3.4_add_attribute"><code>add_attribute</code></a> command is used to specify LAMMPS commands that will be run on each iteration for <code>Sim1</code>. These add a downwards force of 0.1 to the <code>force_group</code> defined in in.Lshape_lmp and then initialise an energy minimisation. Finally the bond energy of the system is captured in the variable <code>cost func</code> after the simulation has been run.</li>
<li>Finally the <a href="3_commands/3.9_add_objective"><code>add_objective</code></a> command links the LAMMPS variable <code>cost_func</code> to the DETO specific variable <code>c1</code> to be included in the objective function.</li>
</ul>
<pre><code># ===== SET OPTIMIZATION STYLE AND PARAMS ========
opt_type 0.1 0.5 gradient_descent
objective_function v_c1

# ===== SET UNIVERSE OF SUB-COMMUNICATORS ========
subcomm 1

# ====== INITIAL SETTINGS FOR ALL LAMMPS INSTANCES =======
lammps file ./inputs/in.Lshape_lmp
dump     1 all custom 1 ./dump/dump.Lshape id type x y v_shyd v_sdev c_nbond

# ====== LOADING CHI MAP AND POTENTIALS FILE =======
opt_map_chi ./inputs/chimap.dat
read_potentials ./inputs/potfile.dat

# # ======= SET SIMULATION NUMBER 1 (RUN TYPE, NO REPEAT)=======
simulation      Sim1 run    repeat no

add_attribute Sim1  fix         force force_group addforce 0 -0.1 0
add_attribute Sim1  fix_modify  force energy yes

add_attribute Sim1 minimize     1.0e-12 1.0e-12 1000000 20000000

#Define variables for cost function
add_attribute Sim1  variable    cost_func equal ebond

# #================== objective variables =============
add_objective Sim1 c1 cost_func
</code></pre>
<p>This simple script illustrates a complete DETO optimisation. However it can be straightforwardly expanded to include multiple simulations and more complex composite objective functions.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Connor-OS/DETO/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
