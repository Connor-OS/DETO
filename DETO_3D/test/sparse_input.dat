#Sample input for DETO3D

# To run the code on a MAC simply type
#    /opt/local/bin/mpiexec-mpich-mp -np 1 ./deto input.dat

# ===== SET OPTIMIZATION STYLE AND PARAMS ========
#opt_type genetic tour var pop_size cross_rate mut_rate
opt_type genetic 15 0.95 0.01



# ===== SET UNIVERSE OF SUB-COMMUNICATORS ========

# command structure: subcomm Nsubcomms
subcomm 2


# ====== INITIAL SETTINGS FOR ALL LAMMPS INSTANCES =======
lammps	dimension	2
lammps	units		si
lammps	boundary	s s p
lammps	atom_style	hybrid sphere bond
lammps  comm_modify 	vel yes
lammps	newton		off
lammps  special_bonds lj 0.0 1.0 1.0 # Important when using bond style many

lammps	variable    	nelx equal 45
lammps	variable    	nely equal 15

lammps	lattice     	hex 1
lammps	region		box block 0 $(v_nelx-1) 0 $((v_nely-1)/2) -0.1 0.1 units lattice
lammps	create_box	3 box bond/types 2 extra/bond/per/atom 12
lammps	create_atoms	2 box
lammps	mass        	* 1
lammps	set 		type 1 diameter 1

lammps	neighbor	2.1 bin					
lammps	neigh_modify	delay 0



# loading the command defining lammps potentials from a separate file (if too many to specify directly here)


lammps	dump		1 all atom 100 dump.beam								
lammps	thermo		200				

lammps	region		1 block INF 1.2 INF 0.1 INF INF units lattice
lammps	region		2 block $(v_nelx-2.2) INF INF 0.1 INF INF units lattice
lammps	group		support1 region 1				
lammps	group		support2 region 2
lammps	fix 		support1 support1 setforce 0 0 0				
lammps	fix	    	support2 support2 setforce 0 0 0
lammps  set         group support1 type 3
lammps  set         group support2 type 3

lammps	variable	half_minus equal $(v_nelx-1)/2-1.2
lammps	variable	half_plus equal $(v_nelx-1)/2+1.2
lammps	region		3 block $(v_half_minus) $(v_half_plus) $((v_nely-1)/2) INF INF INF units lattice										
lammps	group		force_group region 3											
lammps	set 		group force_group type 3

lammps  fix 		damping all viscous 1.5
lammps  write_dump  all atom dump.beam 

# ====== LOADING CHI MAP AND POTENTIALS FILE =======

# loading chi map from file
opt_map_chi chimap_sparse.dat

read_potentials potfile_sparse.dat


# constraints added with constrain function of type: volume or local_volume
#opt_constraint          homo avgchi scale 0.6



# ======= SET SIMULATION NUMBER 1 (RUN TYPE, NO REPEAT)=======

simulation		Sim1 run repeat no      # fix of type "simulation", ID , type = "run" or "cstgs", repeat = yes or no (default is no)
 						
#add_attribute Sim1	variable	half_minus equal $(v_nelx-1)/2-1.2
#add_attribute Sim1	variable	half_plus equal $(v_nelx-1)/2+1.2
#add_attribute Sim1	region		3 block $(v_half_minus) $(v_half_plus) $((v_nely-1)/2) INF INF INF units lattice										
			
#add_attribute Sim1	group		force_group region 3							
			
add_attribute Sim1	variable	nrg equal pe     # this will be recorded into an objective later: DO NOT DELETE VIA ADD_ATTRIBUTE!
add_attribute Sim1	variable	pressure equal press     # this will be recorded into an objective later: DO NOT DELETE VIA ADD_ATTRIBUTE!
add_attribute Sim1	fix		force force_group addforce 0 -1.0 0
add_attribute Sim1	fix_modify	force energy yes	

add_attribute Sim1 write_dump   all atom dump.beam modify append yes

add_attribute Sim1	minimize	1.0e-12 1.0e-12 100000 200000

#add_attribute Sim1 write_dump   all atom dump.beam modify append yes

add_attribute Sim1 	unfix 		force
#add_attribute Sim1 	set 		group force_group type 1	
#add_attribute Sim1  	group 		force_group delete
#add_attribute Sim1  	region		3 delete
#add_attribute Sim1  	variable 	half_plus delete
#add_attribute Sim1  	variable 	half_minus delete


add_objective Sim1 c1 nrg      # NOW, after recording the nrg value, the code will automatically do  "variable nrg delete"    
add_objective Sim1 c2 pressure
