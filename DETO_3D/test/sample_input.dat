#Sample input for DETO3D

# To run the code on a MAC simply type
#    /opt/local/bin/mpiexec-mpich-mp -np 1 ./deto input.dat


# ===== SET UNIVERSE OF SUB-COMMUNICATORS ========

# command structure: subcomm Nsubcomms
subcomm 2


# ====== INITIAL SETTINGS FOR ALL LAMMPS INSTANCES =======
lammps	dimension	    2
lammps	units		    si
lammps	boundary	    s s p
lammps	atom_style	    hybrid sphere bond

lammps	variable    	nelx equal 75
lammps	variable    	nely equal 25

lammps	lattice     	hex 1
lammps	region		    box block 0 $(v_nelx-1) 0 $((v_nely-1)/2) -0.1 0.1 units lattice
lammps	create_box	    12 box bond/types 68 extra/bond/per/atom 12
lammps	create_atoms	1 box
lammps	mass        	* 1
lammps   set type 1 diameter 1

lammps	neighbor	0.001 bin					
lammps	neigh_modify	delay 0					
		
# loading the command defining lammps potentials from a separate file (if too many to specify directly here)
lammps include  potfile.dat
					
lammps	pair_style	zero	1.1051				
lammps	pair_coeff	* *					
							
lammps	bond_style	harmonic					
lammps	bond_coeff	*	100	0.7			
# --------------------------------------------------

lammps	create_bonds	many	all	all	1	0.9	1.1

lammps	dump		1 all atom 100 dump.beam								
lammps	thermo		200				

lammps	region		1 block INF 0.01 INF 0.1 INF INF units lattice
lammps	region		2 block $(v_nelx-1) INF INF 0.01 INF INF units lattice	
lammps	group		support1 region 1				
lammps	group		support2 region 2				
lammps	set 		group support1 type 2				
lammps	set 		group support2 type 2	
lammps	fix 		support1 support1 setforce 0 0 0				
lammps	fix	    	support2 support2 setforce 0 0 0	


# ====== LOADING CHI MAP AND POTENTIALS FILE =======

# loading chi map from file
opt_map_chi chimap.dat





# ======= SET SIMULATION NUMBER 1 (RUN TYPE, NO REPEAT)=======

simulation  Sim1 run repeat no        # fix of type "simulation", ID , type = "run" or "cstgs", repeat = yes or no (default is no)
 						
add_attribute Sim1	variable    half_minus equal $(v_nelx-1)/2-0.2
add_attribute Sim1	variable    half_plus equal $(v_nelx-1)/2+0.2
add_attribute Sim1	region		3 block $(v_half_minus) $(v_half_plus) $((v_nely-1)/2) INF INF INF units lattice										
			
add_attribute Sim1	group		force_group region 3				
							
add_attribute Sim1	set 		group force_group type 2				
			
add_attribute Sim1	variable		nrg equal pe     # this will be recorded into an objective later: DO NOT DELETE VIA ADD_ATTRIBUTE!
add_attribute Sim1	variable		pressure equal press     # this will be recorded into an objective later: DO NOT DELETE VIA ADD_ATTRIBUTE!
add_attribute Sim1	fix		force force_group addforce 0 -.1 0
add_attribute Sim1	fix_modify	force energy yes	

add_attribute Sim1	minimize	1.0e-10 1.0e-10 1000 2000			

add_attribute Sim1 	unfix 		force
add_attribute Sim1 	set 		group force_group type 1	
add_attribute Sim1  	group 		force_group delete
add_attribute Sim1  	region 		3 delete
add_attribute Sim1  	variable 	half_plus delete
add_attribute Sim1  	variable 	half_minus delete


add_objective Sim1 c1 nrg      # NOW, after recording the nrg value, the code will automatically do  "variable nrg delete"    
add_objective Sim1 c2 pressure 


# ======= SET SIMULATION NUMBER 2 (CSTGS TYPE, NO REPEAT)=======

simulation  Sim2 cstgs var_force linear_search 1 10 repeat no        # fix of type "simulation", ID , type = "run" or "cstgs", repeat = yes or no (default is no)

add_attribute Sim2	variable    half_minus equal $(v_nelx-1)/2-0.2
add_attribute Sim2	variable    half_plus equal $(v_nelx-1)/2+0.2
add_attribute Sim2	region		3 block $(v_half_minus) $(v_half_plus) $((v_nely-1)/2) INF INF INF units lattice										
			
add_attribute Sim2	group		force_group region 3				
							
add_attribute Sim2	set 		group force_group type 2				

add_attribute Sim2  variable    cstgs_force
add_attribute Sim2	fix		    force force_group addforce 0 -$(v_cstgs_force)
add_attribute Sim2	fix_modify	force energy yes	

add_attribute Sim2	minimize	1.0e-10 1.0e-10 1000 2000			

add_attribute Sim2 	unfix 		force
add_attribute Sim2 	set 		group force_group type 1	
add_attribute Sim2  	group 		force_group delete
add_attribute Sim2  	region 		3 delete
add_attribute Sim2  	variable 	half_plus delete
add_attribute Sim2  	variable 	half_minus delete

add_objective Sim2 c3 nrg      # NOW, after recording the nrg value, the code will automatically do  "variable nrg delete"    
add_objective Sim2 c4 pressure 

# ======= SET SIMULATION NUMBER 3 (run TYPE, REPEAT)=======

simulation  Sim3 run repeat yes repeat.dat       # fix of type "simulation", ID , type = "run" or "cstgs", repeat = yes or no (default is no)

add_attribute Sim3  bond_coeff	*	$(v_repeat_stiffness)	0.7


add_attribute Sim3	variable    half_minus equal $(v_nelx-1)/2-0.2
add_attribute Sim3	variable    half_plus equal $(v_nelx-1)/2+0.2
add_attribute Sim3	region		3 block $(v_half_minus) $(v_half_plus) $((v_nely-1)/2) INF INF INF units lattice										
			
add_attribute Sim3	group		force_group region 3				
							
add_attribute Sim3	set 		group force_group type 2				

add_attribute Sim3  variable    repeat_force
add_attribute Sim3	fix		    force force_group addforce 0 -$(v_repeat_force)
add_attribute Sim3	fix_modify	force energy yes	

add_attribute Sim3	minimize	1.0e-10 1.0e-10 1000 2000			

add_attribute Sim3 	unfix 		force
add_attribute Sim3 	set 		group force_group type 1	
add_attribute Sim3  	group 		force_group delete
add_attribute Sim3  	region 		3 delete
add_attribute Sim3  	variable 	half_plus delete
add_attribute Sim3  	variable 	half_minus delete

add_objective Sim3 c5 nrg      # NOW, after recording the nrg value, the code will automatically do  "variable nrg delete"    
add_objective Sim3 c6 pressure 
